<%- include('partials/header.ejs') %>
<section>
  <h2>✅ Test de Connexion DB Réussi : Données des Hôtels</h2>
  <ul>
    <h1>Bienvenue, <%= clientProfil.prenom %> <%= clientProfil.nom %> (<%= user.role %>)</h1>
    <p>Email : <%= clientProfil.email %></p>
    <p>Adresse : <%= clientProfil.rue %>, <%= clientProfil.ville %></p>
  </ul>
  <hr />
  <p>
    La création d'un client (register.ejs + login.ejs + profil.ejs avec une
    session) est fonctionnelle.
  </p>
  <button style="padding: 5px 10px">
    <a href="/logout">Déconnexion</a>
  </button>
</section>
<hr>
<!-- Section des réservations -->
<h2>Mes Réservations</h2>
<section>
  <% if (reservations && reservations.length > 0) { %>
        <table border="1" cellpadding="10" style="border-collapse: collapse; width: 100%;">
            <thead>
                <tr>
                    <th>Hôtel</th>
                    <th>Dates</th>
                    <th>Prix</th>
                    <th>Statut</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <% reservations.forEach(function(resa) { %>
                    <tr>
                        <td>
                            <strong><%= resa.hotel_name %></strong><br>
                            <small><%= resa.hotel_city %></small>
                        </td>
                        <td>
                            Du <%= new Date(resa.date_sejour_debut).toLocaleDateString() %><br>
                            au <%= new Date(resa.date_sejour_fin).toLocaleDateString() %>
                        </td>
                        <td><%= resa.montant_total %> €</td>
                        <td>
                            <span class="statut-<%= resa.statut_commande %>">
                                <%= resa.statut_commande %>
                            </span>
                        </td>
                        <td>
                            <a href="/hotel/<%= resa.id_hotel %>">Revoir l'hôtel</a>
                            <br>
                            <!-- <a href="/hotel/<%= resa.id_hotel %>">Annulation</a> -->
                        </td>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    <% } else { %>
        <p>Vous n'avez pas encore effectué de réservation.</p>
        <a href="/" class="btn">Trouver un hôtel</a>
    <% } %>
</section>
<hr />
<!-- Formulaire de recherche d'hôtel -->
<h2>Rechercher un hôtel</h2>
<section>
  <form action="search" method="GET" novalidate>
    <h2>Formulaire de Recherche</h2>
    <select name="lieu" id="lieu" required>
      <option value="">--Veuillez choisir une ville (obligatoire)--</option>
      <option value="Paris">Paris</option>
      <option value="Lyon">Lyon</option>
      <option value="Lille">Lille</option>
      <option value="Bordeaux">Bordeaux</option>
      <option value="Marseille">Marseille</option>
      <option value="Lourdes">Lourdes</option>
    </select>
    <label for="date_debut">Date d'arriver (obligatoire) :</label>
    <input type="date" id="date_debut" name="date_debut" required />
    <label for="date_fin">Date de départ (obligatoire) :</label>
    <input type="date" id="date_fin" name="date_fin" required />
    <label for="adultes">Nombre d'adultes (obligatoire) :</label>
    <input type="number" id="adultes" name="adultes" required />
    <label for="enfants">Nombre d'enfants :</label>
    <input type="number" id="enfants" name="enfants" value="0" />
    <label>
      <input type="checkbox" name="animaux" value="true" /> Animaux acceptés </label
    ><br />
    <label>
      <input type="checkbox" name="wifi" value="true" /> Wi-Fi gratuit </label
    ><br />
    <label>
      <input type="checkbox" name="piscine" value="true" /> Piscine </label
    ><br />
    <label>
      <input type="checkbox" name="spa" value="true" /> Spa / Centre de
      bien-être </label
    ><br />
    <div><button type="submit">Envoyer</button></div>
  </form>
</section>
<script>
  // Script pour gérer les dates dans le formulaire de recherche
  // Empêche de choisir une date passée
  // Définit la date minimale pour les deux champs de date
  const today = new Date().toISOString().split("T")[0];
  document.getElementById("date_debut").setAttribute("min", today);
  document.getElementById("date_fin").setAttribute("min", today);
  const dateDebutInput = document.getElementById("date_debut");
  const dateFinInput = document.getElementById("date_fin");

  dateDebutInput.addEventListener("change", function () {
    dateFinInput.setAttribute("min", this.value);
  });
</script>

<%- include('partials/footer.ejs') %>
